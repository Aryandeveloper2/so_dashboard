{% extends 'default/template/account/layout.twig' %}

{% block content %}


<div class="main-content account-box last-order">
    <div class="head-sec">
        <h2 class="flex-center">
            <svg class="bi" fill="currentColor"><use xlink:href="#order-icon"></use></svg>
            <span class="mr-3">{{ heading_title }}</span>
        </h2>
    </div>


    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        {% for key, category in category_list %}
          <li class="nav-item order-category "  data-category="{{ key }}" role="presentation">
            <button class="nav-link  {{ loop.first ? 'active' : '' }}" id="category-{{key}}-tab" 
            data-bs-toggle="pill" data-bs-target="#category-{{key}}" 
           
            type="button" role="tab" aria-controls="category-{{key}}" {{ loop.first ? ' aria-selected="true"' : '' }}>
                {{category}}
                
                
                <span class="badge bg-danger">{{ category_total[key] }}</span>
                </button>
          </li>
        {% endfor %}
    </ul>

    {% if orders %}
            
            <div class="order_list row">
                
                {% for order in orders %}
                    {{ order.html }}
                {% endfor %}
            </div>
            
            <div class="d-flex align-items-center">
                <div class="col-sm-6 text-left order_pagination">{{ pagination }}</div>
                <div class="col-sm-6 text-right order_result">{{ results }}</div>
                <div class="buttons clearfix">
                <div class="pull-right"><a href="{{ continue }}" class="btn btn-primary">{{ button_continue }}</a></div>
                </div>
</div>

            {% else %}
                <div class="empty_order">
                <div><svg class="bi" fill="currentColor"><use xlink:href="#empty-order-icon"></use></svg></div>
                <p>{{ text_empty }}</p>
                </div>
                <div class="buttons clearfix">
                <div class="pull-right"><a href="{{ continue }}" class="btn btn-primary">{{ button_continue }}</a></div>
                </div>
    {% endif %}

</div>


<script>

    document.addEventListener("DOMContentLoaded", function() {
        const buttons = document.querySelectorAll('.order-category');

        buttons.forEach(button => {
            button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
    
                    document.querySelector('.order_list').innerHTML = `
                        <div class="row">
                        
                            <p class="loading">
                                لطفا منتظر بمانید
                            </p>
                            
                        </div>
                    
                    `
                    _ajax.get(`index.php?route=account/order/filter?category=${category}`)
                        .then(response => {
                            console.log(response)
                            let html = ``
                            response.orders.map((item, index) => {
                            console.log(item)
                                html += item.html
                            })
                            console.log(html)
                            if(html == '') {
                                
                            document.querySelector('.order_list').innerHTML = `
                            <div class="row">
                            
                                <p>
                                هنوز هیچ سفارشی ندادید
                                </p>
                                
                            </div>
                            
                            `;
                            } else {
                                
                            document.querySelector('.order_list').innerHTML = html
                            }
                            document.querySelector('.order_pagination').innerHTML = response.pagination
                            document.querySelector('.order_result').innerHTML = response.results
                        })
                        .catch(error => console.error('Error:', error));
                
            });
        });
        
    });
    
    
</script>

{% endblock %}




